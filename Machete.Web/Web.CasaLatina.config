<?xml version="1.0" encoding="utf-8"?>

<!-- For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  <appSettings xdt:Transform="Replace">
    <add key="webpages:Version" value="3.0.0.0" />
    <add key="webpages:Enabled" value="false" />
    <add key="PreserveLoginUrl" value="true" />
    <add key="ClientValidationEnabled" value="true" />
    <add key="UnobtrusiveJavaScriptEnabled" value="true" />
  </appSettings>

  <system.web>
    <compilation xdt:Transform="RemoveAttributes(debug)" />
    <!--
      In the example below, the "Replace" transform will replace the entire 
      <customErrors> section of your web.config file.
      Note that because there is only one customErrors section under the 
      <system.web> node, there is no need to use the "xdt:Locator" attribute.
      
      <customErrors defaultRedirect="GenericError.htm"
        mode="RemoteOnly" xdt:Transform="Replace">
        <error statusCode="500" redirect="InternalError.htm"/>
      </customErrors>
    -->
  </system.web>
  <system.webServer>
    <rewrite xdt:Transform="InsertIfMissing">
      <rules>
        <rule name="Redirect to https">
          <match url="(.*)" />
          <conditions>
            <add input="{SERVER_PORT}" pattern="443" negate="true" />
          </conditions>
          <action type="Redirect" url="https://machete-casa.azurewebsites.net/{R:1}" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>
  <nlog xdt:Transform="Replace" autoReload="true" throwExceptions="true" internalLogFile="C:\inetpub\wwwroot\machete-casa\nlog_internal.txt" internalLogLevel="Debug"
    internalLogToConsole="true">
    <extensions>
      <add assembly="NLog.Extended" />
    </extensions>
    <targets>
      <target name="database" type="Database" dbprovider="mssql" connectionStringName="ELMAHlog">
        <commandText>
          insert into NLog ([time_stamp],[level],[host],[type],[source],[logger],[message],[stacktrace],[username],[RecordID]) values(@time_stamp,@level,@host,@type,@source,@logger,@message,@stacktrace,@AspNetUserIdentity, @RecordID);
        </commandText>
        <parameter name="@time_stamp" layout="${Date}" />
        <parameter name="@level" layout="${level}" />
        <parameter name="@host" layout="${machinename}" />
        <parameter name="@type" layout="${exception:format=type}" />
        <parameter name="@source" layout="${callsite:className=false:fileName=false:includeSourcePath=false:methodName=true}" />
        <parameter name="@logger" layout="${logger}" />
        <parameter name="@message" layout="${message}" />
        <parameter name="@stacktrace" layout="${exception:stacktrace}" />
        <parameter name="@AspNetUserIdentity" layout="${aspnet-user-identity}${event-context:item=username}" />
        <parameter name="@RecordID" layout="${event-context:item=RecordID}" />
      </target>
    </targets>
    <rules>
      <logger name="*" minlevel="Debug" appendTo="database" />
    </rules>
  </nlog>
</configuration>